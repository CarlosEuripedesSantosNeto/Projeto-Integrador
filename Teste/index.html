<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Perfil</title>

    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@3.2.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@200;300;400;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="profile-container">
      <h1>Perfil do Usu√°rio</h1>
      <div class="profile-pic-container">
        <img
          id="profilePic"
          src="default-profile-pic.jpg"
          alt="Profile Picture"
        />
      </div>
      <input type="file" id="profilePicInput" accept="image/*" />
      <button id="uploadProfilePicBtn">Upload</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyDAVyzcKFW9W5TWCCLuXTq4RgPmTv_loEc",
        authDomain: "banco-7eaec.firebaseapp.com",
        projectId: "banco-7eaec",
        storageBucket: "banco-7eaec.appspot.com",
        messagingSenderId: "273595281648",
        appId: "1:273595281648:web:f24fe2f7d6066e46a69235",
        measurementId: "G-T6PG24C641",
      };

      firebase.initializeApp(firebaseConfig);

      document.addEventListener("DOMContentLoaded", () => {
        const profilePicInput = document.getElementById("profilePicInput");
        const uploadProfilePicBtn = document.getElementById(
          "uploadProfilePicBtn"
        );
        const profilePic = document.getElementById("profilePic");

        uploadProfilePicBtn.addEventListener("click", () => {
          const file = profilePicInput.files[0];
          if (file) {
            uploadProfilePic(file);
          } else {
            alert("Por favor, selecione uma imagem primeiro.");
          }
        });

        function uploadProfilePic(file) {
          const userId = firebase.auth().currentUser.uid;
          const storageRef = firebase.storage().ref();
          const profilePicRef = storageRef.child(`profilePics/${userId}.jpg`);

          profilePicRef
            .put(file)
            .then(() => {
              profilePicRef.getDownloadURL().then((url) => {
                profilePic.src = url;

                // Atualiza a URL da foto de perfil no banco de dados
                firebase
                  .database()
                  .ref(`users/${userId}/profilePicUrl`)
                  .set(url);
              });
            })
            .catch((error) => {
              console.error("Erro ao fazer upload da imagem: ", error);
            });
        }

        firebase.auth().onAuthStateChanged((user) => {
          if (user) {
            const userId = user.uid;

            firebase
              .database()
              .ref(`users/${userId}/profilePicUrl`)
              .once("value")
              .then((snapshot) => {
                const profilePicUrl = snapshot.val();
                if (profilePicUrl) {
                  profilePic.src = profilePicUrl;
                }
              });
          }
        });
      });
    </script>
  </body>
</html>
